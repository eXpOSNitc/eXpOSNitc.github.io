<!DOCTYPE html>
<html lang="en">
  <head>

    <!-- Basic Page Needs
    ================================================== -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
     <title> File Manager</title>

    <!-- Mobile Specific Metas
    ================================================== -->
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Favicon -->
    <link rel="shortcut icon" type="image/png" href="../img/favicon.jpg"/>

    <!-- CSS
    ================================================== -->       
    <!-- Bootstrap css file-->
    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <!-- Font awesome css file-->
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <!-- Superslide css file-->
    <link rel="../stylesheet" href="css/superslides.css">
    <!-- Slick slider css file -->
    <link href="../css/slick.css" rel="stylesheet"> 
    <!-- smooth animate css file -->
    <link rel="stylesheet" href="../css/animate.css">  
    <!-- Elastic grid css file -->
    <link rel="stylesheet" href="../css/elastic_grid.css"> 
    <!-- Circle counter cdn css file -->
    <link rel='stylesheet prefetch' href='../css/jquery.circliful.css'>    
    <!-- Default Theme css file -->
    <link id="orginal" href="../css/themes/eucalyptus-theme.css" rel="stylesheet">
    <!-- Main structure css file -->
    <link href="../style.css" rel="stylesheet">
   
    <!-- Google fonts -->
    <link href='../css/opensans.css' rel='stylesheet' type='text/css'>
    <link href='../css/varela.css' rel='stylesheet' type='text/css'>
    <link href='../css/montserrat.css' rel='stylesheet' type='text/css'>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  
 <style type="text/css">
   
   pre{
    font-family: Times new Roman; 
    font-size: 15px;"
   }

 </style>>   

  </head>
  <body> 
     <!-- BEGAIN PRELOADER 
    <div id="preloader">
      <div id="status">&nbsp;</div>
    </div>
     END PRELOADER -->

  
    <!--=========== BEGIN HEADER SECTION ================-->
    <header id="header">
      <!-- BEGIN MENU -->
      <div class="menu_area">
        <nav class="navbar navbar-default navbar-fixed-top past-main" role="navigation"> 
          <div class="container">
          <div class="navbar-header">
            <!-- FOR MOBILE VIEW COLLAPSED BUTTON -->
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>

            <!-- LOGO -->

            <!-- TEXT BASED LOGO -->
            <a class="navbar-brand" href="index.html">eXpOS<span>NITC</span></a>
            
                              
          </div>
          <div id="navbar" class="navbar-collapse collapse">
            <ul id="top-menu" class="nav navbar-nav navbar-right main_nav">
	      <li><a href="../index.html">Home</a></li>
              <li><a href="../documentation.html" target="_blank">Documentation</a></li> 
              <li><a href="../Roadmap.html" target="_blank">Roadmap</a></li>
               <li><a href="../Downloads.html" target="_blank">Downloads</a></li> <!--Change here--> 
               <li><a href="../faq.html" target="_blank">FAQ</a></li>
              <li><a href="../About_us.html" target="_blank">About Us</a></li>                                     
            </ul>           
          </div>
          </div>     
        </nav>  
      </div>
      <!-- END MENU -->

      
    </header>
		
    <!--=========== End HEADER SECTION ================--> 
    
    <!--begin section-->
    <section id="abi" style="text-align:justify">
		<br>
		<br>
		<br>
      <div class="container">
        <div class="row">
          <div class="col-lg-12 col-md-12">
            <div class="about_area">
             
                <!-- START ABOUT HEADING -->
              <div class="heading">
                
                <h2 >  File Manager </h2>
                <br/>
                <br/>
                
                <p> This module contains the functions that manages files.

                </p>
		<p><b>Important Note:</b> All functions in this module expect that the <b>inode is locked</b> before they are called.</p>
              </div>

                 <br> <br> 


<table class="table table-bordered" style="text-align: center;">
    <tr class="success">
        <th style="text-align: center;">Function Number</th>
        <th style="text-align: center;">Function Name</th>
        <th style="text-align: center;">Arguments</th>
        <th style="text-align: center;">Return Value</th>
    </tr>


  <tr>    
    <td>1</td>
    <td>Buffered Write</td>
    <td>Disk Number, Offset, Word </td>
    <td>NIL</td>
  </tr>
       

 <tr>    
    <td>2</td>
    <td>Buffered Read</td>
    <td>Disk Number, Offset, Memory Address</td>
    <td>NIL</td>
  </tr>

 <tr>    
    <td>3</td>
    <td>Open</td>
    <td>File Name</td>
    <td>File Table Index, -1 or -2</td>
  </tr>

 <tr>    
    <td>4</td>
    <td>Close</td>
    <td>File Table Index</td>
    <td>NIL</td>
  </tr>


   </table>
                     

               
   <h3> Buffered Write </h3>
   <i> <b>Description </b></i>: The disk page provided is loaded to the corresponding buffer. The word provided is written into the offset position of the buffer.<br> Buffer managemnet is handled by this function internally.<br><br>

<pre
    Identify the buffer ; 			
    /* Buffer Number = (Disk Number % 4) is a simple scheme, 
    good enough for our purposes. More efficient schemes are used in real systems */
    
    Acquire the buffer by calling the Acquire_Buffer() function	
    in the <a href="Module_0.html">Resource Manager module</a>;
    
    if (the buffer contains a different disk block){  			/* check block number in <a href="../os_design-files/mem_ds.html#buffer_table">Buffer Table</a>. */
        
        if (the buffer contents are dirty){					/* check DIRTY BIT of buffer table */
              Write back the contents of the buffer
              to the disk by invoking disk_store() 
              function in the <a href="Module_4.html">device manager module</a>;
        }
        
        Load the required disk block into the buffer by invoking
        the disk_load() function in the <a href="Module_4.html">device manager module</a>;

        Set the new Disk block number in the Buffer table entry;
    }
    
    Write the contents of the word taken as input into the offset
    location in the buffer; 
    
    Mark the buffer as Dirty;
    
    Release the buffer by calling the Release_Buffer() function
    in the Resource Manager module;
    
    return;
</pre>

Called by the Write system call.




 <h3> Buffered Read </h3>
 <i> <b>Description </b></i>: The disk page provided is loaded to the corresponding buffer. The word present at the offset position of the buffer is copied to the Memory address provided as input. Buffer management is handled by this function internally.<br> <br>
NOTE: Physical memory address must be provided. <br> <br>
<pre>
    Identify the buffer ; 			
    /* Buffer Number = (Disk Number % 4) is a simple scheme, 
    good enough for our purposes. More efficient schemes are used in real systems */
    
    Acquire the buffer by calling the Acquire_Buffer() function
    in the <a href="Module_0.html">Resource Manager module</a>;
    
    if (the buffer contains a different disk block){  			/* check block number in <a href="../os_design-files/mem_ds.html#buffer_table">Buffer Table</a>. */
        
        if (the buffer contents are dirty){					/* check DIRTY BIT of buffer table */
              Write back the contents of the buffer
              to the disk by invoking disk_store() 
              function in the <a href="Module_4.html">device manager module</a>;
              
              Mark the buffer as clean in the 
              corresponding buffer table entry;
        }
        
        Load the required disk block into the buffer by invoking
        the disk_load() function in the device manager module;

        Set the new Disk block number in the Buffer table entry;
    }
    
    Copy the contents in the offset location in the buffer to the
    physical address given as input; 
        
    Release the buffer by calling the Release_Buffer() function
    in the Resource Manager module;
    
    return;

</pre>

Called by the Read system call. <br> <br><br>
           
   <h3> Open </h3>
   <i> <b>Description </b></i>: Locates the file in the inode table and makes an entry in the Open File Table. Returns the Open File Table index or an error code if file does not exist or the table is full.<br>
   <br>
   <b>Note:</b> This function must not be called unless a the calling process has a free entry available in the <a href="../os_design-files/process_table.html#per_process_table">per-process resource table</a> to store the open file table index returned by this function.<br><br>

<pre>

Find the index of the <a href="../os_design-files/disk_ds.html#inode_table">Inode Table</a> entry of the file.

Call the <b>acquire_inode()</b> function in the <a href="../os_modules/Module_0.html">Resource Manager</a> module.&nbsp;&nbsp; /* Lock the inode */
If the locking fails, return -1. 

If file name in the inode table entry does not match the input file name or if it is of type EXEC, <b>release_inode()</b> and return -1. 	/* Only data files can be opened */

Find a free entry in the <a href="../os_design-files/mem_ds.html#file_table">Open File Table</a>.
If there are no free entries, <b>release_inode()</b> and return -2.  /* Reached maximum number of open files in the system. */

<b>If</b> the file name is "root" <b>then</b> 
	Set the INODE INDEX field in the open file table entry to INODE_ROOT. 
<b>else</b>
	Increment the File Open Count in the <a href="../os_design-files/mem_ds.html#file_lock_status_table">File Status Table</a> 
	Set the INODE INDEX field in the open file table entry to the inode table index of the file. 

Set the OPEN INSTANCE COUNT to 1 and LSEEK to 0 in the open file table entry.

Call the <b>release_inode()</b> function in the <a href="../os_modules/Module_0.html">Resource Manager</a> module.&nbsp;&nbsp; /* Free the inode */

return the Open File Table Index.

Question: 
	1. Why don't we need to maintain file open count for the root file? We still need to maintain open instance count for the root file, why?
	2. After acquiring the inode, why do we check if the input file name matches the inode table entry?
</pre>

Called by the open system call.

<h3> Close </h3>
   <i> <b>Description </b></i>: Closes the open instance of a file. Assumes a valid Open File Table index is given as input. <br><br> 

<pre>

Find the index of the <a href="../os_design-files/disk_ds.html#inode_table">Inode Table</a> entry of the file from the Open File Table.

In the <a href="../os_design-files/mem_ds.html#file_table">Open File Table Entry</a>, decrement the Open Instance Count.

If the count becomes 0
	Invalidate the entry by setting all fields to -1.
	If the file is not the "root", decrement the File Open Count in the <a href="../os_design-files/mem_ds.html#file_lock_status_table">File (Inode) Status Table</a>.
	/* Check the INODE_INDEX field in the Open File Table entry */

return;
</pre>

Called by the close, exit system call.




                     <!--end-->   
                    
                               </div>
              </div>
            </div>
          </div>
        </div>       
      </div>
       	
		 
    </section>
    
    <!--end section-->
                
 <!--=========== BEGIN FOOTER ================-->
     <footer id="footer">
       <div class="container">
         <div class="row">
           <div class="col-lg-6 col-md-6 col-sm-6">
             <div class="footer_left">
               <p><a href="http://www.nitc.ac.in/">National Institute of Technology, Calicut</a></p>
             </div>
           </div>
         </div>
       </div>
      </footer>
      <!--=========== END FOOTER ================-->

     <!-- Javascript Files
     ================================================== -->
  
     <!-- initialize jQuery Library -->
    <script src="js/jquery.min.js"></script>
    <!-- Google map -->
    <script src="js/map_js.js"></script>
    <script src="js/jquery.ui.map.js"></script>
     <!-- For smooth animatin  -->
    <script src="js/wow.min.js"></script> 
    <!-- Bootstrap js -->
    <script src="js/bootstrap.min.js"></script>
    <!-- superslides slider -->
    <script src="js/jquery.superslides.min.js" type="text/javascript"></script>
    <!-- slick slider -->
    <script src="js/slick.min.js"></script>    
    <!-- for circle counter -->
    <script src='js/jquery.circliful.min.js'></script>
    <!-- for portfolio filter gallery -->
    <script src="js/modernizr.custom.js"></script>
    <script src="js/classie.js"></script>
    <script src="js/elastic_grid.min.js"></script>
    <script src="js/portfolio_slider.js"></script>

    <!-- Custom js-->
    <script src="js/custom.js"></script>
  </body>
</html>
